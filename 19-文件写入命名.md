åœ¨ä½ çš„è¿™æ®µ C++ ä»£ç ä¸­ï¼Œ`originprocess` æ¨¡å—çš„ Python æ–‡ä»¶åœ°å€æ˜¯ï¼š

```
E:/Yangranran/decon/sparse-deconv-py/originprocess.py
```

### åŸå› åˆ†æï¼š
ä½ çš„ä»£ç é‡Œæœ‰è¿™ä¸¤å¥ï¼š

```cpp
QString workDirT = R"(E:/Yangranran/decon/sparse-deconv-py)";
QString pyFileT = "originprocess";
```

éšåè°ƒç”¨äº†ï¼š

```cpp
PyObject *pModuleT = PyImport_ImportModule("originprocess");
```

åŒæ—¶å‰é¢ä½ æ·»åŠ äº†è·¯å¾„ï¼š

```cpp
PyRun_SimpleString("sys.path.append('E:/Yangranran/decon/sparse-deconv-py')");
```

è¿™æ„å‘³ç€ Python è§£é‡Šå™¨ä¼šåœ¨ `E:/Yangranran/decon/sparse-deconv-py` è¿™ä¸ªç›®å½•ä¸‹æŸ¥æ‰¾ `originprocess.py` æ–‡ä»¶ã€‚

---

### âœ… è¦ç¡®è®¤çš„äº‹é¡¹ï¼š
1. è¯·ç¡®ä¿ **`originprocess.py`** æ–‡ä»¶ç¡®å®å­˜åœ¨äº `E:/Yangranran/decon/sparse-deconv-py`ã€‚
2. ä½ å¯ä»¥åœ¨ Python ç»ˆç«¯ä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ç¡®è®¤è·¯å¾„æ˜¯å¦å¯ç”¨ï¼š
```python
import sys
sys.path.append('E:/Yangranran/decon/sparse-deconv-py')
import originprocess
```

å¦‚æœæˆåŠŸå¯¼å…¥è€Œæ²¡æœ‰æŠ¥é”™ï¼Œè·¯å¾„å°±æ˜¯æ­£ç¡®çš„ã€‚

---

å¦‚æœä½ è¿˜æœ‰æŠ¥é”™æˆ–æ˜¯å¸Œæœ›æˆ‘å¸®ä½ æ£€æŸ¥ `originprocess.py` çš„å†…å®¹ç»“æ„æ˜¯å¦åˆé€‚ï¼Œä¹Ÿå¯ä»¥è´´ä¸€ä¸‹ä»£ç æ¥çœ‹çœ‹~

éå¸¸å¥½çš„å»ºè®®ï¼æˆ‘ä»¬æ¥**é€æ­¥åˆ†æå‡½æ•°è°ƒç”¨é“¾æ¡ä¸­æ¯ä¸ªè·¯å¾„å‚æ•°çš„å®é™…å«ä¹‰**ï¼Œç„¶å**ç»™å‡ºä¸€ä¸ªæ ¹æ®å‡½æ•°å†…å®¹è‡ªåŠ¨åˆ›å»ºæˆ–æ£€æŸ¥è·¯å¾„çš„å»ºè®®æ–¹å¼**ï¼Œå¸®åŠ©ä½ è®©æ•´ä¸ªè„šæœ¬é²æ£’æ€§æ›´å¼ºã€ç»“æ„æ›´æ¸…æ™°ã€‚

---

## âœ… æ¯ä¸ªè·¯å¾„å˜é‡çš„å«ä¹‰ & æ¨èèµ‹å€¼æ–¹å¼ï¼ˆé…åˆå‡½æ•°ï¼‰

---

### `img_folder`
```python
img_folder = r"D:\pythoncode\mitoimageprocessing\3Dscanning\188\threshold"
```
- **å«ä¹‰**ï¼šåŸå§‹å›¾åƒè·¯å¾„ï¼Œå¯èƒ½æ˜¯ä½ å¤„ç†å¥½çš„æŸç§é˜ˆå€¼å›¾åƒé›†ã€‚
- âœ… **ä½ ç›®å‰åªæ˜¯ä¸ºäº†æ£€æŸ¥æ’åºï¼Œå¯¹æµç¨‹ä¸å…³é”®ã€‚**

---

### `thresholdtarget`
```python
thresholdtarget = r"D:\pythoncode\mitoimageprocessing\3Dscanning\188\threshold"
```
- **ä¼ å…¥å‡½æ•°**ï¼š
  ```python
  save_images_to_tiff(thresholdtarget, output_tiff_file1)
  ```
- **å«ä¹‰**ï¼šè¿™ä¸ªç›®å½•ä¸­ä¿å­˜äº†ä½ åˆšåˆšä»åŸå§‹ `.tif` åˆ†å±‚å¾—åˆ°çš„ `.jpg` æ–‡ä»¶ã€‚
- âœ… **å¿…é¡»åŒ…å« `.jpg` æˆ– `.tif` å›¾åƒæ‰æœ‰æ•ˆã€‚**

---

### `segtarget`
```python
segtarget = r"D:\pythoncode\mitoimageprocessing\3Dscanning\188\seg"
```
- **ä½¿ç”¨**ï¼š
  ```python
  cv2.imwrite(f"{segtarget}_greenmax.tif", result0)
  ```
- âš ï¸ **æ³¨æ„**ï¼šä¸æ˜¯æ–‡ä»¶å¤¹ï¼Œè€Œæ˜¯**æ–‡ä»¶è·¯å¾„çš„å‰ç¼€**ã€‚
- âœ… å»ºè®®æ”¹ä¸ºï¼š
  ```python
  segtarget = r"D:\pythoncode\mitoimageprocessing\3Dscanning\188\seg\seg"
  ```

---

### `tiff_file_path`
```python
tiff_file_path = r"D:\pythoncode\mitoimageprocessing\3Dscanning\188\188_microscope_volume_yrr.tif"
```
- **å«ä¹‰**ï¼šåŸå§‹çš„ `.tif` ä½“ç§¯å›¾åƒã€‚
- âœ… ç¡®ä¿è¿™ä¸ªè·¯å¾„ä¸‹çš„æ–‡ä»¶å­˜åœ¨ï¼Œå¹¶æ˜¯ 3D å›¾åƒå †æ ˆã€‚

---

### `image_dir` å’Œ `output_tiff_file1`
```python
image_dir = r"D:\pythoncode\mitoimageprocessing\3Dscanning\188\3Dvolume"
output_tiff_file1 = os.path.join(image_dir, "microscope_volume.tiff")
```
- âœ… ä¿å­˜ç”± `thresholdtarget` ä¸­çš„ `.jpg` ç”Ÿæˆçš„ `.tiff` æ–‡ä»¶ã€‚

---

### `image_dir2` å’Œ `output_tiff_file2`
```python
image_dir2 = r"D:\pythoncode\mitoimageprocessing\3Dscanning\188\maxintsity"
output_tiff_file2 = os.path.join(image_dir2, "max_projection_image2.jpg")
```
- âœ… ä¿å­˜æœ€å¤§æŠ•å½±å›¾åƒã€‚

---

## âœ… è‡ªåŠ¨åˆ›å»ºè·¯å¾„å»ºè®®ï¼ˆåŠ åœ¨ `main()` å‰é¢ï¼‰

ä½ å¯ä»¥åŠ ä¸Šä¸€æ®µåˆ›å»ºæ–‡ä»¶å¤¹çš„ä»£ç ï¼Œé˜²æ­¢ä¿å­˜å¤±è´¥ï¼š

```python
def ensure_dir(path):
    if not os.path.exists(path):
        os.makedirs(path)

# åˆ›å»ºè¾“å‡ºè·¯å¾„
ensure_dir(r"D:\pythoncode\mitoimageprocessing\3Dscanning\188\3Dvolume")
ensure_dir(r"D:\pythoncode\mitoimageprocessing\3Dscanning\188\maxintsity")
ensure_dir(r"D:\pythoncode\mitoimageprocessing\3Dscanning\188\seg")
```

---

## âœ… ç®€æ´æ¨¡æ¿ï¼šæ•´ç†èµ‹å€¼é€»è¾‘ï¼ˆå»ºè®®æ‹·è´æ›¿æ¢ï¼‰

```python
base_path = r"D:\pythoncode\mitoimageprocessing\3Dscanning\188"

thresholdtarget = os.path.join(base_path, "threshold")
segtarget = os.path.join(base_path, "seg", "seg")  # æ³¨æ„æ˜¯æ–‡ä»¶å‰ç¼€
tiff_file_path = os.path.join(base_path, "188_microscope_volume_yrr.tif")

image_dir = os.path.join(base_path, "3Dvolume")
output_tiff_file1 = os.path.join(image_dir, "microscope_volume.tiff")

image_dir2 = os.path.join(base_path, "maxintsity")
output_tiff_file2 = os.path.join(image_dir2, "max_projection_image2.jpg")

# è‡ªåŠ¨åˆ›å»ºè¾“å‡ºè·¯å¾„
for folder in [image_dir, image_dir2, os.path.dirname(segtarget)]:
    ensure_dir(folder)
```

---

å¦‚æœä½ æƒ³ï¼Œæˆ‘è¿˜å¯ä»¥ç»™ä½ æ”¹æˆç”¨ argparse è¯»å–å‚æ•°è·¯å¾„ï¼Œæˆ–è€…ç›´æ¥å°è£…æˆä¸€ä¸ªæ›´æ¸…æ™°çš„ pipelineã€‚ä½ è§‰å¾—è¦ä¸è¦ï¼Ÿ
------------------------------------------------------------------------

è¿™æ®µä»£ç çš„å«ä¹‰å¦‚ä¸‹ï¼š

```python
thresholdtarget = r"E:\Yangranran\exercise\Microsystem\BUILD\3Dscanning\188\threshold"
mask_file = f"{thresholdtarget}\\{i}_threshold.jpg"
```

ç­‰ä»·äºï¼š

```python
mask_file = "E:\\Yangranran\\exercise\\Microsystem\\BUILD\\3Dscanning\\188\\threshold\\{i}_threshold.jpg"
```

è¿™é‡Œçš„é€»è¾‘æ˜¯ï¼š

- `thresholdtarget`ï¼šæ˜¯ä¸€ä¸ª**æ–‡ä»¶å¤¹è·¯å¾„**ï¼Œå³é˜ˆå€¼å›¾åƒï¼ˆthreshold maskï¼‰å­˜å‚¨çš„ç›®å½•ã€‚
- `f"{thresholdtarget}\\{i}_threshold.jpg"`ï¼šæ˜¯**æ‹¼æ¥æ–‡ä»¶å**çš„æ–¹å¼ï¼Œå°†è¯¥è·¯å¾„å’Œå›¾åƒæ–‡ä»¶åæ‹¼æ¥èµ·æ¥ã€‚`{i}` æ˜¯ä¸€ä¸ªå˜é‡ï¼Œé€šå¸¸æ˜¯å½“å‰å¤„ç†çš„å›¾åƒå±‚ç¼–å·ï¼ˆæ¯”å¦‚ 0, 1, 2...ï¼‰ã€‚

### ä¸æ˜¯å¤šä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œè€Œæ˜¯æ‹¼æ¥ä¸€ä¸ªæ–‡ä»¶å

è¿™è¡Œä»£ç ä¸æ˜¯æŒ‡â€œè·¯å¾„ä¹‹åè¿˜æœ‰ä¸€ä¸ªæ–‡ä»¶å¤¹åâ€ï¼Œè€Œæ˜¯æŒ‡åœ¨ `thresholdtarget` è¿™ä¸ªæ–‡ä»¶å¤¹é‡Œï¼Œæ‰¾ä¸€ä¸ªå« `i_threshold.jpg` çš„å›¾åƒæ–‡ä»¶ã€‚ä¾‹å¦‚ï¼š

å‡è®¾ï¼š
```python
i = 5
```

é‚£ä¹ˆï¼š
```python
mask_file = "E:\\Yangranran\\exercise\\Microsystem\\BUILD\\3Dscanning\\188\\threshold\\5_threshold.jpg"
```

è¿™ä¸ªè·¯å¾„è¡¨ç¤ºï¼š**åœ¨ `threshold` æ–‡ä»¶å¤¹ä¸­æŸ¥æ‰¾åä¸º `5_threshold.jpg` çš„æ–‡ä»¶ã€‚**

---

å¦‚æœä½ è¿˜æœ‰æ–‡ä»¶è¯»å–æˆ–è·¯å¾„æ‹¼æ¥æ–¹é¢çš„é—®é¢˜ï¼Œä¹Ÿå¯ä»¥ç”¨ `os.path.join()` æˆ– `pathlib.Path` å†™å¾—æ›´å®‰å…¨ä¸€äº›ã€‚æ¯”å¦‚ï¼š

```python
from pathlib import Path
thresholdtarget = Path(r"E:\Yangranran\exercise\Microsystem\BUILD\3Dscanning\188\threshold")
mask_file = thresholdtarget / f"{i}_threshold.jpg"
``` 

æ›´æ¨èè¿™æ ·å†™ï¼Œé¿å… `\\` çš„é”™è¯¯ã€‚éœ€è¦æˆ‘å¸®ä½ æ”¹æˆè¿™ç§å†™æ³•å—ï¼Ÿ

-------------------------------------------------------
è¿™æ®µä»£ç çš„è·¯å¾„è¡¨ç¤ºçš„æ˜¯ï¼š

```
E:\Yangranran\exercise\Microsystem\BUILD\3Dscanning\188\threshold\{i}_threshold.jpg
```

æ‰€ä»¥æˆ‘ä»¬æ¥ä¸€æ­¥æ­¥æ‹†è§£è·¯å¾„ï¼š

1. `E:\Yangranran\exercise\Microsystem\BUILD\3Dscanning\188`ï¼šæ˜¯ä¸€ä¸ªçˆ¶ç›®å½•ï¼ˆä½ å¯ä»¥ç†è§£ä¸ºæŸæ¬¡å®éªŒæˆ–è€…æ ·æœ¬çš„ç¼–å·æ˜¯ 188ï¼‰ã€‚
2. `threshold`ï¼šæ˜¯åœ¨ 188 æ–‡ä»¶å¤¹**ä¸‹é¢çš„ä¸€ä¸ªå­æ–‡ä»¶å¤¹**ï¼Œç”¨æ¥ä¸“é—¨å­˜æ”¾â€œé˜ˆå€¼å¤„ç†åçš„å›¾åƒâ€ã€‚
3. `{i}_threshold.jpg`ï¼šæ˜¯åœ¨ `threshold` æ–‡ä»¶å¤¹é‡Œçš„ä¸€å¼ å…·ä½“çš„å›¾åƒæ–‡ä»¶ï¼Œæ¯”å¦‚ `0_threshold.jpg`, `1_threshold.jpg`ï¼Œè¡¨ç¤ºç¬¬ 0 å±‚ã€ç¬¬ 1 å±‚çš„é˜ˆå€¼å›¾ã€‚

ğŸ” **ç»“è®ºï¼š**

âœ… **ä¸æ˜¯ç›´æ¥ä¿å­˜åœ¨ `188` æ–‡ä»¶å¤¹ä¸‹ï¼Œè€Œæ˜¯ä¿å­˜åœ¨ `188` ä¸‹çš„ `threshold` å­æ–‡ä»¶å¤¹ä¸­ã€‚**

ä¹Ÿå°±æ˜¯è¯´ä½ çš„å›¾åƒæ–‡ä»¶ `i_threshold.jpg` æ˜¯åœ¨è¿™ä¸ªå®Œæ•´çš„è·¯å¾„é‡Œï¼š

```
E:\Yangranran\exercise\Microsystem\BUILD\3Dscanning\188\threshold\
```

ğŸ“¦ æ–‡ä»¶ç»“æ„å¯èƒ½åƒè¿™æ ·ï¼š

```
188\
 â”œâ”€ threshold\
 â”‚   â”œâ”€ 0_threshold.jpg
 â”‚   â”œâ”€ 1_threshold.jpg
 â”‚   â””â”€ ...
```

ä½ å¯ä»¥åœ¨ `188` æ–‡ä»¶å¤¹ä¸‹æ‰‹åŠ¨ç¡®è®¤ä¸€ä¸‹æ˜¯å¦å­˜åœ¨ `threshold` æ–‡ä»¶å¤¹ï¼Œå¹¶ä¸”é‡Œé¢æœ‰ä½ ç”Ÿæˆçš„å›¾ç‰‡æ–‡ä»¶ã€‚éœ€è¦æˆ‘å¸®ä½ å†™ä¸€æ®µæ£€æŸ¥è¿™ä¸ªç›®å½•å’Œæ–‡ä»¶æ˜¯å¦å­˜åœ¨çš„ Python ä»£ç å—ï¼Ÿ
--------------------------------------------------
è¿™æ®µä»£ç çš„è·¯å¾„ä¹Ÿå¯ä»¥æ‹†è§£ä¸€ä¸‹æ¥åˆ†æä½ å›¾ç‰‡åˆ°åº•ä¿å­˜åœ¨äº†å“ªé‡Œï¼š

---

### ğŸ§© åˆ†æä»£ç ï¼š

```python
image_dir = r'E:\Yangranran\exercise\Microsystem\BUILD\3Dscanning\188\3Dvolume'
output_tiff_file1 = image_dir + r'\\' + 'microscope_volume.tiff'
```

ğŸ‘‰ æ‹¼æ¥å `output_tiff_file1` çš„ç»“æœæ˜¯ï¼š

```
E:\Yangranran\exercise\Microsystem\BUILD\3Dscanning\188\3Dvolume\\microscope_volume.tiff
```

è™½ç„¶è·¯å¾„ä¸­æœ‰ `\\`ï¼Œä½† Python ä¼šè‡ªåŠ¨å¤„ç†ä¸ºæ­£å¸¸çš„è·¯å¾„ï¼š

```
E:\Yangranran\exercise\Microsystem\BUILD\3Dscanning\188\3Dvolume\microscope_volume.tiff
```

---

### âœ… ç»“è®ºï¼š

- `microscope_volume.tiff` æ–‡ä»¶æ˜¯**ä¿å­˜åœ¨ `188\3Dvolume` æ–‡ä»¶å¤¹ä¸‹**çš„ã€‚
- ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä¸æ˜¯ç›´æ¥åœ¨ `188` æ–‡ä»¶å¤¹ï¼Œè€Œæ˜¯åœ¨å®ƒä¸‹é¢çš„ `3Dvolume` å­ç›®å½•ä¸­ã€‚

ğŸ“¦ æ–‡ä»¶ç»“æ„ç¤ºæ„ï¼š

```
188\
 â”œâ”€ threshold\
 â”œâ”€ 3Dvolume\
 â”‚   â””â”€ microscope_volume.tiff
```

---

### ğŸ’¡ å°å»ºè®®ï¼š

ä½ ä¹Ÿå¯ä»¥ç”¨ `os.path.join()` æ¥æ›´å®‰å…¨åœ°æ‹¼æ¥è·¯å¾„ï¼Œé˜²æ­¢è·¯å¾„åˆ†éš”ç¬¦å‡ºé”™ï¼š

```python
import os
output_tiff_file1 = os.path.join(image_dir, 'microscope_volume.tiff')
```

éœ€è¦æˆ‘å¸®ä½ å†™ä¸€æ®µä»£ç æ¥æ£€æŸ¥è¿™ä¸ª `.tiff` æ–‡ä»¶æ˜¯å¦å·²ç»ç”Ÿæˆäº†å—ï¼Ÿ
